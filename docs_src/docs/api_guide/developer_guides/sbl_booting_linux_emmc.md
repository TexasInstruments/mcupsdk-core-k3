# SBL Booting Linux From eMMC {#SBL_BOOTING_LINUX_EMMC}

[TOC]

## Introduction
\cond SOC_AM64X
- SBL booting Linux from eMMC (see \ref EXAMPLES_DRIVERS_SBL_EMMC_LINUX) is a secondary bootloader application that boots Linux on A53 core and RTOS/NORTOS application on R5, M4 cores.
- The bootloader makes use of two appimages
    - One containing the application images(RTOS/NORTOS) for R5, M4 cores.
    - Other containing the Linux binaries(ATF, OPTEE, SPL) for A53 core.
\endcond

\cond SOC_AM62X
- The bootloader makes use of 6 appimages
    - A Linux appimage containing the **Linux binaries (ATF, OPTEE, SPL)**.
    - Appimage for **SBL stage1**
    - Appimage for **SBL stage2**
    - Appimage for **MCU M4**
    - Appimage for **HSM M4**
    - DM firmware appimage for **DM R5**
\endcond
\cond SOC_AM62AX
- The bootloader makes use of 6 appimages
    - A Linux appimage containing the **Linux binaries (ATF, OPTEE, SPL)**.
    - Appimage for **SBL stage1**
    - Appimage for **SBL stage2**
    - Appimage for **MCU R5**
    - Appimage for **HSM M4**
    - DM firmware appimage for **DM R5**
\endcond
- The Linux appimage can be generated by using \ref LINUX_APPIMAGE_GEN_TOOL
- The appimages will be flashed to the offset on eMMC specified by SysCfg, the SBL parses the appimages from these locations, loads and run the cores.

## Features Supported

- Boots R5, M4 cores and Linux on A53 from eMMC.
- SBL booting Linux can be used when early booting of R5 and M4 cores are required. When using uBoot to run R5 and M4 cores the application will start running on R5, M4 cores only after booting Linux

## Features NOT Supported
\cond !SOC_AM62AX
- SBL booting Linux supports only booting from OSPI (see \ref EXAMPLES_DRIVERS_SBL_OSPI_LINUX_MULTISTAGE) and eMMC.
\endcond
\cond SOC_AM62AX
- SBL booting Linux supports only booting from OSPI (see \ref EXAMPLES_DRIVERS_SBL_OSPI_NAND_LINUX_MULTISTAGE) and eMMC.
\endcond
- If SD card or other boot modes are required, user might need to switch to booting Linux using Linux uBoot.

## Bootflow for SBL booting linux from eMMC

\note The binaries for R5, M4 cores need not be in the linux file system `(root/lib/firmware)`, when SBL is booting Linux.

\cond SOC_AM64X
- The bootflow for SBL booting Linux is as follows

    \imageStyle{sbl_booting_linux_emmc.png,width:60%}
    \image html sbl_booting_linux_emmc.png "Bootflow for SBL booting Linux"
\endcond

\cond SOC_AM62X
- The bootflow for SBL booting Linux is as follows

    \imageStyle{sbl_booting_linux_emmc_am62x.png,width:60%}
    \image html sbl_booting_linux_emmc_am62x.png "Bootflow for SBL booting Linux"
\endcond

\cond SOC_AM62AX
- The bootflow for SBL booting Linux is as follows

    \imageStyle{sbl_booting_linux_emmc_am62ax.png,width:60%}
    \image html sbl_booting_linux_emmc_am62ax.png "Bootflow for SBL booting Linux"
\endcond

\cond SOC_AM64X
## SRAM memory layout for SBL booting Linux

\note The memory load address for core applications must not overlap with one other
\attention The load address for R5 and M4 core applications must be consistant with the memory layout in Linux dts

- Shown below is the memory map in SRAM for SBL booting Linux

    \imageStyle{sram_memory_map.png,width:20%}
    \image html sram_memory_map.png "SRAM memory map for SBL booting Linux"
\endcond
## EMMC Partitioning

\cond SOC_AM64X
\note The default SD card image for AM64x-evm can be used to boot Linux using SBL
\note The tiboot3.bin, tispl.bin will not be used for booting Linux when using SBL booting Linux.
\note The R5 binaries in the root partition (eg : `root/lib/firmware/am64-main-r5f0_0-fw`) will not be used when SBL boots Linux and R5,M4 cores.
\endcond

\cond SOC_AM62X
\note The default SD card image for AM62x-evm can be used to boot Linux using SBL
\note The tiboot3.bin, tispl.bin will not be used for booting Linux when using SBL booting Linux.
\note The R5 binaries in the root partition (eg : `root/lib/firmware/am62-main-r5f0_0-fw`) will not be used when SBL boots Linux and R5,M4 cores.
\endcond

\cond SOC_AM62AX
\note The default SD card image for AM62Ax-evm can be used to boot Linux using SBL
\note The tiboot3.bin, tispl.bin will not be used for booting Linux when using SBL booting Linux.
\note The R5 binaries in the root partition (eg : `root/lib/firmware/am62a-main-r5f0_0-fw`) will not be used when SBL boots Linux and R5,M4 cores.
\endcond

- eMMC uses two patitions to boot Linux
    - A boot patition
        - tiboot3.bin
        - tispl.bin
        - u-boot.img
        - uboot.env
    - A ext4 partition in the user data area containing
        - Linux Kernel image
        - Linux DTB
        - Linux file system

## See Also
\cond SOC_AM64X
- \ref EXAMPLES_DRIVERS_SBL_EMMC_LINUX
\endcond
\cond SOC_AM62X
- \ref EXAMPLES_DRIVERS_SBL_EMMC_LINUX_MULTISTAGE
\endcond
- \ref LINUX_APPIMAGE_GEN_TOOL